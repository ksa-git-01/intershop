# Проектная работа 7 спринта

## Spring Boot Webflux приложение Intershop

### Технологии

```
Java 21
Spring Boot 3.5.4
PostgreSQL 16.9
Maven
openapi-generator-maven-plugin
Testcontainers
Docker & Docker Compose
```

### Требования к окружению

```
Docker Desktop
JDK 21
Клонировать репозиторий: https://github.com/ksa-git-01/intershop.git
```

### Запуск тестов

Из корня проекта:

```
./mvnw clean test
```

Первый запуск может быть долгим, т.к. будут скачаны необходимые образы и зависимости

### Сборка и запуск

Из корня проекта:

```
docker-compose up
```

Используются порты ОС хоста: 
18081 - сервис витрины товаров
18082 - сервис оплаты
15432 - PostgreSQL
16379 - Redis


Первый запуск может быть долгим, т.к. будут скачаны необходимые образы и зависимости

### Ресурсы проекта

```
Веб-страницы:
Список товаров: http://localhost:18080/main/items
Добавление товара: http://localhost:18080/items/add
Просмотр товара: http://localhost:18080/items/{id}
Список заказов: http://localhost:18080/orders
Просмотр заказа: http://localhost:18080/orders/{id}
Корзина: http://localhost:18080/cart/items

RESTFull эндпоинты сервиса оплаты:
GET "/balance" - Получить баланс
POST "/payment" - Осуществить платеж

Эндпоинты витрины товаров:
GET "/" - редирект на "/main/items"
GET "/main/items" - список всех товаров плиткой на главной странице
POST "/main/items/{id}" - изменить количество товара в корзине
GET "/cart/items" - список товаров в корзине
POST "/cart/items/{id}" - изменить количество товара в корзине
GET "/items/{id}" - карточка товара
POST "/items/{id}" - изменить количество товара в корзине
POST "/buy" - купить товары в корзине
GET "/orders" - список заказов
GET "/orders/{id}" - карточка заказа
GET /images/{filename} - получить картинку

OpenAPI спецификация сервиса оплаты:
intershop\payment\src\main\resources\payment-service-api.yaml
```

### Примечания по реализации

```
1. Хранение изображений товаров реализовано в файловой системе (используется volume docker контейнера)
   В реальном приложении скорее всего использовалось бы S3 совместимое хранилище
2. При запуске приложения прогоняется скрипт, который генерирует демонстрационный набор данных,
   но без картинок. При перезапуске приложения данные удаляются и генерируются заново.
4. Для модели данных СУБД создана ER-диаграмма в PlantUML. В гитхабе настроен action,
   который генерирует png картинку на основе кода диаграмы.
   Action срабатывает при коммите изменений файла с кодом диаграммы
5. Используются HTML шаблоны из описания задания. Эндпоинты реализованы под требования шаблонов.
6. Реализован мультимодульный проект, включающий в себя два Maven модуля: 
payment - сервис оплаты
store - сервис витрины товаров
7. Сервис store взаимодействует с сервисом pyment по http внутри докер сети 
(url сервиса оплаты в докер сети указан в Open API специцикации и используется при автоматической генерации веб клиента)
```

### ER-диаграмма:

![](/src/main/diagrams/generated/er-diagram.png)